/* 
* jCountdown 1.3 jQuery Plugin
* Copyright 2011 Tom Ellis http://www.webmuse.co.uk
* Licensed under MIT License
* See http://www.webmuse.co.uk/license/
*/
(function(k){k.fn.countdown=function(r){var x={date:new Date,updateTime:1E3,htmlTemplate:'%{d} <span class="cd-time">days</span> %{h} <span class="cd-time">hours</span> %{m} <span class="cd-time">mins</span> %{s} <span class="cd-time">sec</span>',minus:false,onChange:null,onComplete:null,onResume:null,onPause:null,leadingZero:false,offset:null,direction:"down"},y=[].slice,l=Math.floor,t=/(%\{d\}|%\{h\}|%\{m\}|%\{s\})/g,m=/%\{d\}/,n=/%\{h\}/,o=/%\{m\}/,p=/%\{s\}/,u=function(c){c=c||0;var a=0,b=new Date;
c*=36E5;a=b.getTime()- -b.getTimezoneOffset()/60*36E5;c=b.setTime(a+c);return new Date(c)},v=function(){var c,a,b,f,d,h,g;c="";var e=this.data("jcdSettings");if(e){c=e.htmlTemplate;a=e.offset===null?new Date:u(e.offset);b=new Date(e.date);f=(e.direction==="down"?b.getTime()-a.getTime():a.getTime()-b.getTime())/864E5;d=l(f);h=(f-d)*24;f=l(h);g=l((h-f)*60);h=l(((h-f)*60-g)*60);if(e.leadingZero){if(d<10)d="0"+d;if(f<10)f="0"+f;if(g<10)g="0"+g;if(h<10)h="0"+h}if(e.direction==="down"&&(a<=b||e.minus))c=
c.replace(m,d).replace(n,f).replace(o,g).replace(p,h);else if(e.direction==="up"&&(b<=a||e.minus))c=c.replace(m,d).replace(n,f).replace(o,g).replace(p,h);else{c=c.replace(t,"00");e.hasCompleted=true}this.html(c);this.trigger("change",[e]);if(e.hasCompleted){this.trigger("complete.jcountdown");window.clearInterval(e.timer)}}},w={init:function(c){var a=k.extend({},x,c),b;b=a.htmlTemplate;return this.each(function(){var f=k(this),d={},h=a.offset===null?new Date:u(a.offset),g=new Date(a.date),e=(a.direction===
"down"?g.getTime()-h.getTime():h.getTime()-g.getTime())/864E5,i=l(e),j=(e-i)*24;e=l(j);var q=l((j-e)*60),s=l(((j-e)*60-q)*60);j="";a.onChange&&f.bind("change.jcountdown",a.onChange);a.onComplete&&f.bind("complete.jcountdown",a.onComplete);a.onPause&&f.bind("pause.jcountdown",a.onPause);a.onResume&&f.bind("resume.jcountdown",a.onResume);if(a.leadingZero){if(i<10)i="0"+i;if(e<10)e="0"+e;if(q<10)q="0"+q;if(s<10)s="0"+s}d.hasCompleted=false;if(a.direction==="down"&&(h<=g||a.minus))j=b.replace(m,i).replace(n,
e).replace(o,q).replace(p,s);else if(a.direction==="up"&&(g<=h||a.minus))j=b.replace(m,i).replace(n,e).replace(o,q).replace(p,s);else{j=b.replace(t,"00");d.hasCompleted=true}d.originalContent=k(this).html();d.date=a.date;d.leadingZero=a.leadingZero;d.updateTime=a.updateTime;d.direction=a.direction;d.template=a.htmlTemplate;d.htmlTemplate=a.htmlTemplate;d.minus=a.minus;d.offset=a.offset;d.onChange=a.onChange;d.onComplete=a.onComplete;d.onResume=a.onResume;d.onPause=a.onPause;if(!d.hasCompleted){h=
k.proxy(v,f);d.timer=window.setInterval(h,d.updateTime)}f.data("jcdSettings",d);f.html(j);if(d.hasCompleted){f.trigger("complete.jcountdown");window.clearInterval(d.timer)}})},changeSettings:function(c){return this.each(function(){var a=k(this),b,f,d,h,g,e,i,j;if(!a.data("jcdSettings"))return true;b=k.extend({},a.data("jcdSettings"),c);f=b.htmlTemplate;d=b.offset===null?new Date:u(b.offset);h=new Date(b.date);g=(b.direction==="down"?h.getTime()-d.getTime():d.getTime()-h.getTime())/864E5;e=l(g);i=
(g-e)*24;g=l(i);j=l((i-g)*60);i=l(((i-g)*60-j)*60);a.unbind(".jcountdown");window.clearInterval(b.timer);b.onChange&&a.bind("change.jcountdown",b.onChange);b.onComplete&&a.bind("complete.jcountdown",b.onComplete);b.onPause&&a.bind("pause.jcountdown",b.onPause);b.onResume&&a.bind("resume.jcountdown",b.onResume);if(b.direction==="down"&&(d<=h||b.minus))f.replace(m,e).replace(n,g).replace(o,j).replace(p,i);else if(b.direction==="up"&&(h<=d||b.minus))f.replace(m,e).replace(n,g).replace(o,j).replace(p,
i);else{f.replace(t,"00");b.hasCompleted=true}f=k.proxy(v,a);b.timer=window.setInterval(f,b.updateTime);a.data("jcdSettings",b);if(b.hasCompleted){a.trigger("complete.jcountdown");window.clearInterval(b.timer)}})},resume:function(){return this.each(function(){var c=k(this),a,b,f,d,h,g,e,i,j;b="";a=c.data("jcdSettings");if(!a)return true;f=k.proxy(v,c);b=a.htmlTemplate;d=a.offset===null?new Date:u(a.offset);h=new Date(a.date);g=(a.direction==="down"?h.getTime()-d.getTime():d.getTime()-h.getTime())/
864E5;e=l(g);i=(g-e)*24;g=l(i);j=l((i-g)*60);i=l(((i-g)*60-j)*60);if(a.direction==="down"&&(d<=h||a.minus))b=b.replace(m,e).replace(n,g).replace(o,j).replace(p,i);else if(a.direction==="up"&&(h<=d||a.minus))b=b.replace(m,e).replace(n,g).replace(o,j).replace(p,i);else{b=b.replace(t,"00");a.hasCompleted=true}a.timer=window.setInterval(f,a.updateTime);c.data("jcdSettings",a);c.trigger("resume.jcountdown");c.html(b).trigger("change.jcountdown");if(a.hasCompleted){c.trigger("complete.jcountdown");window.clearInterval(a.timer)}})},
pause:function(){return this.each(function(){var c=k(this),a=k.data(c[0],"jcdSettings");if(!a)return true;c.trigger("pause.jcountdown");window.clearInterval(a.timer)})},complete:function(){return this.each(function(){var c=k(this),a=c.data("jcdSettings");if(!a)return true;window.clearInterval(a.timer);a.hasCompleted=true;c.data("jcdSettings",a);c.trigger("complete.jcountdown")})},destroy:function(){return this.each(function(){var c=k(this),a;a=c.data("jcdSettings");if(!a)return true;c.unbind(".jcountdown");
c.html(a.originalContent);c.removeData("jcdSettings")})},getSettings:function(c){var a;if(a=k(this[0]).data("jcdSettings"))if(c){if(a[c])return a[c]}else return a}};if(w[r])return w[r].apply(this,y.call(arguments,1));else if(k.type(r)==="object"||!r)return w.init.apply(this,arguments);else k.error("Method "+r+" does not exist in the jCountdown Plugin")}})(jQuery);
